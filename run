#! /bin/bash


SCRIPT_DIR=$(dirname $0)

cd $SCRIPT_DIR

if [ "$PYTHONPATH" != "" ]; then
    PYTHONPATH="$PYTHONPATH:src"
else
    PYTHONPATH="src"
fi
export PYTHONPATH=$PYTHONPATH


export DJANGO_SETTINGS_MODULE="testproject.settings"


function django_is_up() {
    wget -q -O /dev/null "http://localhost:8000/"
}

function wait_until_django_up() {
    echo "Waiting for django to come up..."
    until django_is_up; do sleep 0.2; done
    echo "django found. Continuing..."
}

java -jar selenium-server-standalone-2.0a4.jar &
selenium_pid=$!

sleep 3

cd src/testproject
python manage.py runserver &
django_pid=$!
wait_until_django_up
cd -

python src/runtests.py

kill $django_pid
kill $selenium_pid

